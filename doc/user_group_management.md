# 設計書: ユーザー・グループ管理

## 1. 概要

本システムの権限モデルの基礎となる、ユーザーおよびグループの管理機能に関する仕様を定義する。
これらの機能は、主にシステム管理者向けの機能として実装される。

## 2. データモデル

### 2.1. ユーザー (Users)

| フィールド名 | データ型 | 説明 | 備考 |
| :--- | :--- | :--- | :--- |
| `id` | Long | 一意な識別子 (主キー) | |
| `username` | String | ログインに使用するユーザー名 | 一意である必要がある |
| `password` | String | ハッシュ化されたパスワード | |
| `email` | String | メールアドレス | |
| `is_admin` | Boolean | 管理者権限を持つか否か | |
| ... | ... | | |

### 2.2. グループ (Groups)

| フィールド名 | データ型 | 説明 | 備考 |
| :--- | :--- | :--- | :--- |
| `id` | Long | 一意な識別子 (主キー) | |
| `group_name` | String | グループ名 | 一意である必要がある |
| ... | ... | | |

### 2.3. ユーザーとグループの関連 (中間テーブル: User_Groups)

ユーザーとグループは多対多の関係となるため、中間テーブルを用いて関連を管理する。

| フィールド名 | データ型 | 説明 |
| :--- | :--- | :--- |
| `user_id` | Long | ユーザーID (FK) |
| `group_id` | Long | グループID (FK) |

## 3. 機能要件

これらの機能は管理者用画面から操作できることを想定する。

| No. | 機能 | 概要 | 詳細 |
| :--- | :--- | :--- | :--- |
| 3.1 | ユーザー管理 (CRUD) | ユーザーの作成、一覧表示、編集、削除を行う。 | ・作成時にはユーザー名、パスワード、メールアドレス等を設定する。<br>・ユーザーを削除しても、そのユーザーが所有するファイルは残る仕様とする（所有者の付け替えや、削除不可とする等の検討が必要）。 |
| 3.2 | グループ管理 (CRUD) | グループの作成、一覧表示、編集、削除を行う。 | |
| 3.3 | ユーザーのグループ所属管理 | 特定のユーザーを一つまたは複数のグループに追加、またはグループから削除する。 | ユーザー編集画面またはグループ編集画面で管理できる。 |

## 4. APIエンドポイント（案）

管理者権限が必要なエンドポイント群。

| メソッド | URI | 説明 |
| :--- | :--- | :--- |
| `GET / POST` | `/admin/users` | ユーザーの一覧取得 / 新規作成 |
| `GET / PUT / DELETE` | `/admin/users/{id}` | 特定ユーザーの取得 / 更新 / 削除 |
| `GET / POST` | `/admin/groups` | グループの一覧取得 / 新規作成 |
| `GET / PUT / DELETE` | `/admin/groups/{id}` | 特定グループの取得 / 更新 / 削除 |
| `POST / DELETE` | `/admin/groups/{groupId}/members/{userId}` | グループへのユーザー追加 / グループからのユーザー削除 |

## 5. 考慮事項

-   **ユーザー削除時のファイル所有権**: ユーザーを削除した際に、そのユーザーが所有していたファイル/フォルダの扱いを明確に定義する必要がある。
    -   **案1**: ユーザー削除を不可とし、「無効化」ステータスを設ける。
    -   **案2**: ファイル/フォルダの所有者を特定の管理者ユーザーや「nobody」のような特殊ユーザーに付け替える。
    -   **案3**: 削除時に所有する全ファイルを連鎖的に削除する（危険なため非推奨）。
-   **パスワード管理**: パスワードは必ずハッシュ化（例: BCrypt）してDBに保存する。平文での保存は行わない。
-   **デフォルトグループ**: 新規ユーザー作成時に、自動的に特定のデフォルトグループ（例: `users` グループ）に所属させる仕様も考えられる。
